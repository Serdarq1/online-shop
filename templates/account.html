{% include "base.html" %}
{% block content %}

<div>
    <a href="{{url_for('index')}}"><p class="text-center mt-4 text-2xl font-bold">DRL</p></a>
</div>
<section class="mx-auto max-w-5xl p-6">
  <h1 class="text-2xl font-semibold">Hello{{ ' ' + user.email if user and user.email else '' }}</h1>
  <p class="mt-1 text-sm text-gray-600">Manage your profile, orders, and security.</p>

  <!-- Tabs -->
  <div class="mt-6">
    <div class="flex gap-2 border-b">
      <button data-tab="profile" class="tab-btn rounded-t-md border px-4 py-2 text-sm font-medium cursor-pointer">Profile</button>
      <button data-tab="orders"  class="tab-btn rounded-t-md border px-4 py-2 text-sm font-medium cursor-pointer">Orders</button>
      <button data-tab="addresses" class="tab-btn rounded-t-md border px-4 py-2 text-sm font-medium cursor-pointer">Addresses</button>
      <button data-tab="security" class="tab-btn rounded-t-md border px-4 py-2 text-sm font-medium cursor-pointer">Security</button>
    </div>

    <!-- Panels -->
    <div class="tab-panel border p-4" id="tab-profile">
      <h2 class="mb-3 text-lg font-semibold">Profile</h2>
      <form method="post" action="{{ url_for('update_profile') }}" class="space-y-4 max-w-md">
        <div>
          <label class="block text-sm text-gray-700">Email</label>
          <input type="email" name="email" value="{{ user.email }}" required
                 class="mt-1 w-full rounded-md border px-3 py-2 focus:border-gray-800 focus:ring-gray-800">
        </div>
        <button class="rounded-md bg-gray-800 px-4 py-2 text-white hover:bg-gray-600">Save changes</button>
      </form>
    </div>

    <div class="tab-panel hidden border p-4" id="tab-orders">
      <h2 class="mb-3 text-lg font-semibold">Orders</h2>
      {% if orders %}
        <ul class="space-y-2">
          {% for o in orders %}
            <li class="rounded-md border p-3">
              <div class="flex items-center justify-between">
                <div>
                  <p class="font-medium">Order #{{ o.number }}</p>
                  <p class="text-sm text-gray-600">{{ o.status }}</p>
                </div>
                <p class="font-semibold">{{ '%.2f'|format(o.total) }} â‚º</p>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-sm text-gray-600">You have no orders yet.</p>
      {% endif %}
    </div>

    <div class="tab-panel hidden border p-4" id="tab-addresses">
      <h2 class="mb-3 text-lg font-semibold">Addresses</h2>
      {% if addresses %}
        <div class="grid gap-3 sm:grid-cols-2">
          {% for a in addresses %}
            <div class="rounded-md border p-3">
              <p class="font-medium">{{ a.name }}</p>
              <p class="text-sm text-gray-700">{{ a.line1 }}{{ ', ' + a.line2 if a.line2 }}<br>{{ a.city }}, {{ a.region }} {{ a.postcode }}<br>{{ a.country }}</p>
              <div class="mt-2 flex gap-2">
                <a href="#" class="text-sm underline">Edit</a>
                <a href="#" class="text-sm underline text-red-600">Remove</a>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-sm text-gray-600">No saved addresses.</p>
      {% endif %}
      <div class="mt-4">
        <a href="#" class="rounded-md border px-3 py-2 text-sm hover:bg-gray-50">Add new address</a>
      </div>
    </div>

    <div class="tab-panel hidden border p-4" id="tab-security">
      <h2 class="mb-3 text-lg font-semibold">Security</h2>
      <form method="post" action="{{ url_for('change_password') }}" class="space-y-4 max-w-md">
        <div>
          <label class="block text-sm text-gray-700">Current password</label>
          <input type="password" name="current_password" required class="mt-1 w-full rounded-md border px-3 py-2">
        </div>
        <div>
          <label class="block text-sm text-gray-700">New password</label>
          <input type="password" name="new_password" required class="mt-1 w-full rounded-md border px-3 py-2">
        </div>
        <div>
          <label class="block text-sm text-gray-700">Confirm new password</label>
          <input type="password" name="confirm_password" required class="mt-1 w-full rounded-md border px-3 py-2">
        </div>
        <button class="rounded-md bg-gray-800 px-4 py-2 text-white hover:bg-gray-600">Change password</button>
      </form>
    </div>
  </div>
</section>

<script>
  // tiny tab switcher
  const btns = document.querySelectorAll('.tab-btn');
  const panels = document.querySelectorAll('.tab-panel');
  function showTab(name) {
    panels.forEach(p => p.classList.add('hidden'));
    document.getElementById('tab-' + name).classList.remove('hidden');
    btns.forEach(b => b.classList.toggle('bg-gray-100', b.dataset.tab === name));
  }
  btns.forEach(b => b.addEventListener('click', () => showTab(b.dataset.tab)));
  showTab('profile')
</script>
{% endblock %}
